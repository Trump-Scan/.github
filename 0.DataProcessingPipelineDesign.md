# 데이터 처리 파이프라인 설계

## 서비스 개요
여러 채널에서 올라오는 트럼프의 발언을 실시간으로 수집하고, 한국 경제/시장에 미치는 영향을 분석하여 일반 투자자들에게 신속하게 정보를 제공하는 서비스

---

## 핵심 레이어 구조

### 1. 데이터 수집 레이어 (Data Collection Layer)
**역할**: 여러 소스에서 트럼프 관련 발언/뉴스를 수집하고 구조화된 데이터로 변환

**주요 책임**:
- 다양한 채널 모니터링 및 데이터 수집
- Raw 데이터를 구조화된 형태로 변환
- 메타데이터 추출 (발언 시간, 채널, 원문 링크 등)
- 트럼프 발언인지 검증
- 실시간/준실시간 수집 스케줄링
- **이미 수집한 데이터 추적 및 스킵** (중복 수집 방지)
- **원본 데이터 저장** (재분석 및 감사 목적)

**필요한 컴포넌트**:
- **Source Collectors** (소스별 수집기)
    - Twitter/X Collector: 트럼프 계정 모니터링 + 데이터 추출
    - Truth Social Collector: Truth Social 게시물 수집 + 데이터 추출
    - News Collector: 주요 뉴스 사이트에서 본문 수집 및 추출
    - Press Release Collector: 공식 발표문 수집
- **Scheduler**: 각 소스별 수집 주기 관리
- **State Manager**: 각 소스별 마지막 수집 지점 추적 및 관리
- **Content Validator**: 트럼프 발언이 맞는지 검증 (이름, 계정 확인 등)
- **Data Store**: 원본 데이터 저장

---

### 2. 중복 제거 레이어 (Deduplication Layer)
**역할**: 여러 채널에서 올라온 동일/유사 내용 필터링

**주요 책임**:
- 완전 중복 감지 (동일한 내용)
- 유사 내용 감지 (같은 발언의 다른 표현)
- **1번 레이어에서 저장된 원본 데이터와 비교** (최근 N시간 내 데이터)
- 중복 발견 시 첫 번째 또는 가장 신뢰도 높은 소스만 통과
- 중복된 항목은 처리 중단 (빠른 처리를 위해)

**필요한 컴포넌트**:
- **Duplicate Detector**: 중복 감지 엔진 (해시 기반 완전 일치 검사)
- **Similarity Matcher**: 유사도 비교 (텍스트 유사도 계산)
- **Filter**: 중복 판정 시 처리 중단
- **Data Query**: 최근 N시간 내 저장된 원본 데이터 조회

---

### 3. 분석 레이어 (Analysis Layer)
**역할**: 발언 내용 분석 및 영향도 평가

**주요 책임**:
- 발언 내용 요약 (한국어)
- 한국 경제/시장 영향도 분석
- 관련 산업 식별 (예: 반도체, 자동차, 철강, 에너지 등)

**필요한 컴포넌트**:
- **Summarizer**: 발언 요약 생성 (원문 영어 → 한국어 요약)
- **Impact Analyzer**: 한국 경제/시장 영향도 분석 및 설명
- **Industry Classifier**: 관련 산업 분류 (무역, 환율, 반도체, 자동차 등)

---

### 4. 피드 생성 레이어 (Feed Generation Layer)
**역할**: 최종 사용자에게 제공될 피드 아이템 생성 및 저장

**주요 책임**:
- 분석 결과를 일관된 피드 형태로 생성
- **피드 데이터 저장** (API에서 조회할 수 있도록)

**필요한 컴포넌트**:
- **Feed Builder**: 피드 아이템 생성 (요약, 영향도, 산업, 원문 링크 등 포함)
- **Formatter**: 일관된 피드 형식 생성
- **Feed Store**: 생성된 피드 저장

---

### 5. API 레이어 (API Layer)
**역할**: 프론트엔드에 피드 데이터 제공

**주요 책임**:
- 피드 데이터 조회 인터페이스 제공
- 시간순 정렬 (최신순)
- 실시간 새 피드 전달
- 필터링/검색 기능 (산업별, 날짜별 등)
- 페이지네이션
- **저장된 피드 데이터 조회**

**필요한 컴포넌트**:
- **Request Handler**: 클라이언트 요청 처리
- **Real-time Notifier**: 새 피드 발생 시 실시간 알림
- **Query Processor**: 검색/필터 처리
- **Data Fetcher**: 저장된 피드 조회

---

## 전체 데이터 흐름

```
[다양한 소스 - Twitter, News, Truth Social 등]
    ↓
[1. 데이터 수집]
   - 소스별 Collector가 수집 + 구조화를 동시에 수행
   - 마지막 수집 지점 이후의 새 데이터만 가져옴
   - 구조화된 데이터 생성 (내용, 시간, 링크 등)
   - 원본 데이터 저장 → DB
   - 수집 지점 업데이트
    ↓
[2. 중복 제거]
   - 저장된 원본 데이터(1번 레이어)와 비교하여 중복 체크
   - 여러 소스에서 올라온 동일/유사 내용 필터링
    ↓
[3. 분석]
   - 요약 (한국어)
   - 한국 경제/시장 영향도 평가
   - 관련 산업 식별
    ↓
[4. 피드 생성]
   - 최종 피드 아이템 생성
   - 피드 데이터 저장 → DB
    ↓
[5. API] → [프론트엔드]
   - 저장된 피드 조회 및 시간순 정렬
   - 실시간 새 피드 알림
```

---

## 레이어 간 통신 방식

### 비동기 메시지 기반 처리

각 레이어는 **메시지 큐**를 통해 비동기적으로 통신합니다. 이를 통해 각 레이어가 독립적으로 동작하며, 확장성과 장애 격리가 가능합니다.

### 처리 흐름

```
[1. 데이터 수집]
   ↓ (원본 데이터 저장)
   ↓ (메시지 발행: "새 데이터 ID=123")
   
[메시지 큐]
   ↓
   
[2. 중복 제거] ← 메시지 구독
   ↓ (데이터 ID로 원본 조회)
   ↓ (중복 체크 및 필터링)
   ↓ (통과 시 메시지 발행: "검증된 데이터 ID=123")
   
[메시지 큐]
   ↓
   
[3. 분석] ← 메시지 구독
   ↓ (데이터 ID로 조회)
   ↓ (요약 및 영향도 분석)
   ↓ (메시지 발행: "분석 완료 ID=123")
   
[메시지 큐]
   ↓
   
[4. 피드 생성] ← 메시지 구독
   ↓ (분석 결과 조회)
   ↓ (피드 생성 및 저장)
   ↓ (메시지 발행: "새 피드 ID=456")
   
[메시지 큐]
   ↓
   
[5. API] ← 메시지 구독
   ↓ (실시간 알림 전송)
```

### 장점

- **독립성**: 각 레이어가 독립적으로 배포 및 확장 가능
- **확장성**: 처리량이 많은 레이어만 인스턴스 추가 가능
- **복원력**: 메시지가 큐에 보존되어 실패 시 재처리 가능
- **병렬 처리**: 데이터 수집이 분석 완료를 기다릴 필요 없음

---

## 주요 고려사항

### 성능 요구사항
- **실시간성**: 발언 발생 후 몇 분 내 피드 생성 목표
- **처리량**: 동시에 여러 소스 모니터링 가능
- **확장성**: 소스 추가 시 쉽게 확장 가능한 구조

### 데이터 품질
- **정확성**: 오역이나 잘못된 해석 최소화
- **신뢰성**: 검증된 소스만 활용
- **완전성**: 다중 소스 모니터링을 통한 중요 발언 누락 방지

### 운영 요구사항
- **모니터링**: 각 레이어별 상태 추적
- **에러 핸들링**: 특정 소스 장애 시에도 서비스 지속
- **로깅**: 문제 발생 시 추적 가능한 로그
- **데이터 관리**: 각 레이어에서 필요한 데이터 직접 저장 및 조회

---

## 다음 단계
1. 각 레이어별 구체적인 구현 방법 결정
2. 기술 스택 선정
3. 데이터 소스 구체화
4. 분석 알고리즘/모델 선정